<!DOCTYPE html>
<html>
	<head>
		<title>
			Sensor charts
		</title>
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		<script type="text/javascript">
			google.charts.load('current', {'packages':['line']});
			google.charts.setOnLoadCallback(drawChart);

			var range = 10; //minute

			function drawChart()
			{
				var dataArray = [["Time", "Humi", "Temp"]];

				var initTime = 0;

				{% for log in logs %}
					var data = [];
					var time = charToDate(({{ log.time }}).toString());
					if(initTime == 0) {
						initTime = time.getTime();
					}

					var diff = (initTime - time.getTime())/1000;
					if(diff < range*60) {
						console.log(diff);
						data[0] = -diff;
						data[1] = {{ log.humi }};
						data[2] = {{ log.temp }};
						dataArray.push(data);
					}
				{% endfor %}

				var dataTable = google.visualization.arrayToDataTable(dataArray);

				var options = {
					title: "Temperature & Humidity",
					legend: { position: "bottom" },
					hAxis: {
						title: "interval(sec)",
						viewWindowMode: "explicit",
						viewWindow: {
							min: -range*60,
							max: 0,
						}
					}
				};

				var chart = new google.charts.Line(document.getElementById("chart"));

				if(initTime != 0)
					chart.draw(dataTable, options);
			}


			function charToDate(str)
			{	
				var year = str.slice(0, 4);
				var month = str.slice(4, 6);
				var date = str.slice(6, 8);
				var hour = str.slice(8, 10);
				var min = str.slice(10, 12);
				var sec = str.slice(12, 14);

				var d = new Date(year, month, date, hour, min, sec);
				return d;
				
			}


		</script>
	</head>

	<body>

		<div id="chart" style="width: 500px; height: 300px"></div>
		<div>
			{% for log in logs %}
				<p>
				{{ log.time }}
				{{ log.temp }}
				{{ log.humi }}
				</p>
			{% endfor %}
		</div>
	</body>
</html>
